<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/static/global.min.css">
    <link rel="shortcut icon" type="image/png" href="/static/favicon.png"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <title>SkrrrtCoin - Register</title>
</head>
<body>
    <div class="navbar">
        <a class="logo">
            SkrrrtCoin
        </a>

        <div class="navigation">
            <a class="nav-item" href="/">
                Home
            </a>

            <a class="nav-item" href="/price">
                Price
            </a>

            <a class="nav-item" href="/register">
                Register
            </a>

            <a class="nav-item" href="/balance">
                Balance
            </a>

            <a class="nav-item" href="/send">
                Transaction
            </a>

            <a class="nav-item" href="/ranklist">
                Ranklist
            </a>
        </div>
    </div>

    <div class='register-main'>
        <div class='register'>
            <h2>Register</h2>

            <section class='register-wrapper'>
                <div class='register-item'>
                    <div class="user-exists-error">
                        the set username already exists!
                    </div>

                    <div class="name-too-long-error">
                        the username is too long! (max of 18 characters)
                    </div>

                    <div class="no-name-error">
                        please enter an username!
                    </div>

                    <div class="no-email-error">
                        please enter an email!
                    </div>
                </div>

                <div class='register-item'>
                    <input type='text' placeholder='ReallyInnovativeUsrName' id='name'/>
                </div>

                <div class='register-item'>
                    <label htmlFor='email'></label>
                    <input type='text' placeholder='email@example.com' id='email'/>
                </div>

                <div class='register-item checkbox-text'>
                    <input type="checkbox" name="ranklist" id='ranklist-checkbox' checked>
                    I want that my username gets displayed in the ranklist
                </div>
            </section>

            <div class='button-section'>
                <button class="register-button" onClick="postRegistration()">register</button>
            </div>
        </div>

        <div class="show-wallet-keys disabled">
            <div class="info">
                <h1 class="warning">Wait!</h1>

                before u move on safe these keys, because u never ever gonna get them if u forget them, that means u
                have no access to ur wallet! (this is only for the safety of ur wallet)
            </div>

            <div class="keys">
                Public-Key => <span class="public-key"></span> <br>
                Private-Key => <span class="private-key"></span>
            </div>
        </div>

        <script>
            function postRegistration() {
                // POST the data
                $.ajax({
                   type: "POST",
                   url: "/api/registration",
                   data: `username=${document.getElementById('name').value}&email=${document.getElementById('email').value}&ranklist=${document.getElementById('ranklist-checkbox').value}`,

                   success: function (response) {
                        if (response.succeeded) {
                            $('.show-wallet-keys').removeClass("disabled");
                            $('.register').addClass("disabled");
                            
                            document.getElementsByClassName("public-key")[0].innerHTML = response.public_key;
                            document.getElementsByClassName("private-key")[0].innerHTML = response.private_key;
                            return;
                        }
                        
                        $('.show-wallet-keys').addClass("disabled");
                        $('.register').addClass("disabled");
                        return;
                   }
                });
            }

            $('#name').on('input', function (event) {
                if (event.target.value.length <1) {
                    $('.no-name-error').addClass('errored');
                    $('.register-button').addClass("disabled");
                    return;
                }

                $('.no-name-error').removeClass('errored');
                $('.register-button').removeClass("disabled");

                // check if the username is too long
                if (event.target.value.length >18) {
                    $('.name-too-long-error').addClass('errored');
                    $('.register-button').addClass("disabled");
                    return;
                }

                $('.name-too-long-error').removeClass('errored');
                $('.register-button').removeClass("disabled");

                // GET if the username already exists
                $.ajax({
                   type: "GET",
                   url: "/api/check-registration",
                   data: `name=${document.getElementById('name').value}`,

                   success: function (response) {
                        if (response.exists) {
                            $('.user-exists-error').addClass('errored');
                            $('.register-button').addClass("disabled");
                            return;
                        }

                        $('.user-exists-error').removeClass('errored');
                        $('.register-button').removeClass("disabled");
                        return;
                   }
                });
            });

            $('#email').on('input', function (event) {
                // check if the email is entered
                if (event.target.value.length <1) {
                    $('.no-email-error').addClass('errored');
                    $('.register-button').addClass("disabled");
                    return;
                }

                $('.no-email-error').removeClass('errored');
                $('.register-button').removeClass("disabled");
                return;
            });
        </script>
    </div>
</body>
</html>
